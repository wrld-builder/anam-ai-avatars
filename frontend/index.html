<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    body { display:flex; flex-direction:column; height:100vh; margin:0; font-family:Arial,sans-serif; overflow:hidden; align-items:center; background:#f9f9f9; }
    html,body { height:100%; margin:0; overflow:auto; }
    .burger-menu{cursor:pointer; display:flex; flex-direction:column; gap:4px; position:absolute; top:15px; left:15px; z-index:10;}
    .burger-line{width:30px; height:3px; background:#333; transition:transform .3s;}
    .message{margin-bottom:15px;}
    .message.incoming{display:flex; justify-content:flex-start;}
    .message.outgoing{display:flex; justify-content:flex-end;}
    .message-bubble{background:#f0f0f0; padding:12px; border-radius:12px; max-width:75%; word-wrap:break-word; font-size:.9rem;}
    .message-bubble.incoming{background:#e1f5fe;}
    .message-bubble.outgoing{background:#fff9c4;}
    .drawer{width:300px; background:#fefefe; box-shadow:2px 0 10px rgba(0,0,0,.2); position:fixed; top:0; bottom:0; left:0; transform:translateX(-100%); transition:transform .3s; z-index:9; overflow-y:auto; padding:1.5em 1em; border-right:1px solid #ddd;}
    .drawer.visible{transform:translateX(0);}
    .drawer h2{font-size:1.75rem; color:#333; margin-bottom:1rem; text-align:center; font-weight:bold;}
    .drawer ul{list-style:none; padding:0; margin:0;}
    .drawer ul li{display:flex; align-items:center; padding:12px; margin-bottom:10px; background:#f9f9f9; border-radius:8px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,.1); transition:all .2s; font-size:1rem; color:#333;}
    .drawer ul li:hover{background:#e1f5fe; box-shadow:0 4px 8px rgba(0,0,0,.15);}
    .drawer ul li::before{content:"â€¢"; font-size:1.25rem; margin-right:10px; color:#6200ea;}
    .video-container{position:relative; width:100%; max-width:600px; height:300px; background:#f5f5f5; display:flex; justify-content:center; align-items:center; border-radius:10px; overflow:hidden; box-shadow:0 4px 8px rgba(0,0,0,.1);}
    .video-container.loading::before{content:""; position:absolute; inset:0; background:rgba(255,255,255,.8); z-index:2;}
    .loading-spinner{position:absolute; z-index:3; border:4px solid #ccc; border-top:4px solid #6200ea; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite;}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .video-container video{width:100%; height:100%; z-index:1;}
    #chatContent{width:100%; max-width:800px; display:flex; flex-direction:column; align-items:center; padding:1.5em; background:#fff; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,.1);}
    #chatHistory{width:100%; height:400px; margin-top:20px; overflow-y:auto; padding:15px; border:1px solid #ddd; background:#fefefe; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,.1); font-size:.9rem; line-height:1.4;}
    .controls{position:relative; display:flex; justify-content:center; align-items:center; margin-top:20px; width:100%;}
    .mic-button{border:none; background:#6200ea; cursor:pointer; position:relative; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background-color .3s;}
    .mic-button.active{background:#ff3b3b;}
    .export-button{position:absolute; right:0; bottom:0; width:50px; height:50px; border:transparent; background:transparent; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:background .3s, transform .2s; margin-right:20px;}
    .export-button i{font-size:20px; color:#6200ea;}
    .export-button:hover{background:rgba(98,0,234,.1); transform:scale(1.1);}
    .dropdown-menu-container{width:100%; display:flex; justify-content:center; margin-bottom:20px;}
    #personaSelect{width:80%; max-width:300px; padding:10px; font-size:1rem; border:1px solid #ddd; border-radius:5px; background:#f9f9f9; color:#333; appearance:none; text-align:center; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,.1);}
    #personaSelect:focus{border-color:#6200ea; box-shadow:0 0 5px rgba(98,0,234,.3);}
    @media (min-width:1024px){#chatContent{max-width:900px; margin-top:30px;} #chatHistory{height:500px; font-size:1rem;} .message-bubble{font-size:1rem;}}

    /* --- iOS tap-to-start overlay --- */
    #iosTapGate{position:absolute; inset:0; display:none; align-items:center; justify-content:center; z-index:4; background:rgba(255,255,255,.85); backdrop-filter:saturate(120%) blur(3px);}
    #iosTapGate.visible{display:flex;}
    #iosTapGate button{padding:10px 16px; border:none; border-radius:999px; background:#6200ea; color:#fff; font-size:1rem; box-shadow:0 4px 8px rgba(0,0,0,.15); cursor:pointer;}
  </style>
  <title>Interactive Chat UI</title>
</head>
<body>
  <div class="burger-menu" id="burgerMenu">
    <div class="burger-line"></div><div class="burger-line"></div><div class="burger-line"></div>
  </div>

  <div class="drawer" id="sidebar">
    <h2>Chats</h2>
    <ul id="chatList"></ul><br>
    <div>
      <input type="text" id="chatNameInput" placeholder="Chat Name" />
      <button id="createChatButton">Create Chat</button>
    </div>
  </div>

  <main id="chatContent">
    <div id="selector-persona" class="dropdown-menu-container">
      <select id="personaSelect">
        <option value="" selected disabled>Choose your persona</option>
        <option value="MARIA_MODEL">Maria (psychology expert)</option>
        <option value="VASILISA_MODEL">Vasilisa (ORG Assistant)</option>
        <option value="NICK_MODEL">Nick (Saxe Mortgage assistant)</option>
        <option value="JOHN_PULSE_MODEL">John (Pulse PEMF USA assistant)</option>
      </select>
    </div>

    <div id="videoContainer" class="video-container loading">
      <div id="loading-spinner" class="loading-spinner"></div>
      <video id="avatarVideo" autoplay playsinline muted></video>
      <div id="iosTapGate"><button id="iosTapBtn">Tap to start avatar</button></div>
    </div>

    <div id="chatMsg">Please select one of your chats or create a new one.</div>
    <div id="chatHistory" style="display:none; max-height:35vh;"></div>

    <div class="controls">
      <button class="mic-button" id="listenButton" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"></path>
          <path d="M19 11c0 3.31-2.69 6-6 6s-6-2.69-6-6H5c0 4.08 3.05 7.44 7 7.93V22h2v-3.07c3.95-.49 7-3.85 7-7.93h-2z"></path>
        </svg>
      </button>
      <button class="export-button" id="exportButton" style="display:none;"><i class="fas fa-download"></i></button>
    </div>
  </main>

  <script type="module" src="src/main.ts"></script>
</body>
</html>
